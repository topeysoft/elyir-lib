author: TopeySoft
description: Shared library for TopeySoft's Elyir Home Automation
type: lib
version: 1.0
manifest_version: 2017-09-29
sources:
  - src
includes:
  - include

config_schema:
  - ["device.id", "ELYIR??????"]
  - ["device.default_state", "s", "", {title: "Device default state when started"}]

  - ["pins", "o", {title: "Pins layout"}]
  - ["pins.led", "i", -1, {title: "LED GPIO pin"}]
  - ["pins.button", "i", -1, {title: "Button GPIO pin"}]
  
  - ["owner", "o", {title: "Device owner"}]
  - ["owner.uid", "s", "topeysoft", {title: "Owners Unique Identifier"}]

  - ["wifi.ap.enable",  true]
  - ["wifi.ap.ssid", "Elyir_??????"]
  - ["wifi.ap.pass", "elyir678"]

  - ["mqtt.enable",  true]
  - ["mqtt.server", "10.0.1.40:1883"]
  - ["mqtt.ssl_cert", ""]
  - ["mqtt.ssl_key", ""]

  - ["mqtt.status_interval", "i", 30000, {title: "Status publish interval"}]
  - ["mqtt.base", "s", "users/%s/devices/%s/", {title: "Base topic"}]
  - ["mqtt.broadcast", "s", "broadcast", {title: "Broadcast topic"}]
  - ["mqtt.topic_state", "s", "state", {title: "Topic to which device state is published"}]
  - ["mqtt.topic_state_get", "s", "state/get", {title: "Topic to request current state"}]
  - ["mqtt.topic_state_set", "s", "state/set", {title: "Topic to set device state"}]
  - ["mqtt.topic_info", "s", "info", {title: "Info topic"}]
  - ["mqtt.topic_info_get", "s", "info/get", {title: "Info request topic"}]


conds:
  - when: mos.platform == "esp32"
    apply:
      config_schema:
        - ["pins.led", 13]
        - ["pins.button", 0]
  - when: mos.platform == "esp8266"
    apply:
      config_schema:
        - ["pins.led", 13]
        - ["pins.button", 0]
  - when: mos.platform == "cc3200"
    apply:
      config_schema:
        - ["pins.led", 64]
  - when: mos.platform == "cc3220"
    apply:
      config_schema:
        - ["pins.led", 64]
        - ["pins.button", 15]





# cdefs:
#   MGOS_ENABLE_WEB_CONFIG: 0
#   MGOS_ENABLE_FILE_UPLOAD: 1
#   MGOS_ENABLE_TUNNEL: 0

libs:
  - origin: https://github.com/mongoose-os-libs/ca-bundle
  # - origin: https://github.com/mongoose-os-libs/http-server
  - origin: https://github.com/mongoose-os-libs/ota-http-server
  # - origin: https://github.com/mongoose-os-libs/ota-http-client
  - origin: https://github.com/mongoose-os-libs/rpc-service-config
  - origin: https://github.com/mongoose-os-libs/rpc-service-fs
  - origin: https://github.com/mongoose-os-libs/rpc-service-ota
  - origin: https://github.com/mongoose-os-libs/rpc-uart
  - origin: https://github.com/mongoose-os-libs/wifi
  - origin: https://github.com/mongoose-os-libs/mqtt

tags:
  - http
  - c
  - net
